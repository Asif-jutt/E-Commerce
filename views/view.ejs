<% layout("./layouts/boilerplate") %>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Details</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      background: #1318174b;
    }
    .product-card {
      max-width: 500px;
      margin: auto;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0px 6px 20px rgba(0, 0, 0, 0.1);
      background: #fff;
      transition: transform 0.2s;
    }
    .product-card:hover {
      transform: translateY(-5px);
    }
    .product-img {
      width: 100%;
      height: 300px;
      object-fit: cover;
    }
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      text-decoration: none;
      color: #fff;
      background: #6c757d;
      padding: 8px 14px;
      border-radius: 8px;
      transition: 0.2s;
    }
    .back-btn:hover {
      background: #5a6268;
      text-decoration: none;
      color: #fff;
    }
    .price {
      font-size: 1.3rem;
      font-weight: bold;
      color: #28a745;
    }
    .btn {
        width: 95%;
      }

    a {
      text-decoration: none;
    }
  </style>
</head>
<body>
  



  <div class="container my-5 text-center">
    <h1 class="mb-4 fw-bold"><%= prod.item %></h1>

    <% if (prod) { %>
    <div class="product-card">
      <img src="<%= prod.image %>" alt="<%= prod.name %>" class="product-img" />
      <div class="p-4">
        <p class="price">$<%= prod.price %></p>
        <p class="text-muted">Stock Available: <%= prod.stock %></p>
      </div>
      <a href="/products/cart/<%= prod._id %>" class="btn">
        <i class="fa fa-cart-plus"></i> Add to Cart
      </a>
    </div>
    <% } else { %>
    <p class="text-danger fw-bold">❌ Product not found!</p>
    <% } %>
    <hr class="mt-5 mb-5" />
    <div class="container mt-5">
      <form
        action="/admin/view/<%= prod._id %>/reviews"
        method="POST"
        class="p-4 shadow rounded bg-light"
        style="max-width: 700px; margin: auto"
      >
        <h4 class="mb-4 text-center">Submit a Review</h4>

        <div class="mb-2">
          <label for="range1" class="form-label">Rating (1–5)</label>
          <input
            type="range"
            class="form-range"
            id="range1"
            name="rating"
            min="1"
            max="5"
            required
          />
          <div class="d-flex justify-content-between small text-muted">
            <span>1</span><span>5</span>
          </div>
        </div>

        <div class="mb-3">
          <label for="comment" class="form-label">Your Comment</label>
          <textarea
            id="comment"
            name="comment"
            class="form-control"
            rows="4"
            required
          ></textarea>
        </div>
        <button type="submit" class="btn btn-primary w-100">
          Submit Review
        </button>
      </form>
    </div>
   <div class="container mt-4">
  <h3 class="mb-4">Customer Reviews</h3>

  <div class="row">
    <% reviews.sort((a,b) => new Date(b.createdat) - new Date(a.createdat)).forEach(review => { %>
      <div class="col-md-6 mb-4">
        <div class="card shadow-sm border-0 h-100 p-3">
          <div class="d-flex align-items-start">
            <!-- Avatar -->
            <img src="https://via.placeholder.com/60" class="rounded-circle me-3" alt="User">

            <!-- Content -->
            <div>
              <h6 class="fw-bold mb-1"><%= review.username || 'Anonymous' %></h6>
              <small class="text-muted">
                <%= new Date(review.createdat).toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) %>
              </small>

              <!-- Stars -->
              <div class="text-warning">
                <% for(let i=1; i<=5; i++){ %>
                  <i class="<%= i <= review.rating ? 'fas' : 'far' %> fa-star"></i>
                <% } %>
              </div>
            </div>
          </div>

          <!-- Comment -->
          <p class="mt-3 text-secondary">
            <%= review.comment.length > 200 ? review.comment.substring(0, 200) + '...' : review.comment %>
          </p>

          <!-- Show more button -->
          <% if(review.comment.length > 200){ %>
            <a href="#" class="text-primary fw-bold small">Show more</a>
          <% } %>
          <form action="/admin/view/<%= prod._id %>/reviews/<%=review._id%>" method="post">
            <button type="submit" class="btn btn-danger btn-sm">
              <i class="fas fa-trash-alt"></i> Delete
              back-btn</button>
          </form>       
             


        </div>
      </div>
    <% }) %>
  </div>
</div>

    
    <!-- Bootstrap 5 CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </div>
</body>
